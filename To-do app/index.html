<!DOCTYPE html>
<html>
  <head>
    <title>To-Do List</title>
    <style>
      span.bullet {
        margin-left: 10px;
        margin-right: 5px;
        font-weight: bold;
        color: #555;
        padding-right: 5px;
      }

      table {
        border-collapse: collapse;
        width: 100%;
      }

      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }

      th {
        background-color: #f2f2f2;
      }

      .bullet {
        display: inline-block;
        width: 10px;
        text-align: center;
        cursor: pointer;
      }

      .done {
        text-decoration: line-through;
      }

      #add-task {
        display: none;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <h1>To-Do List</h1>
    <form>
      <label for="date">Date (DD-Month-YYYY):</label>
      <input type="text" id="date" name="date" />
      <input type="submit" value="Submit" />
    </form>
    <div id="to-do-list"></div>
    <button id="add-task">Add Task</button>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var form = document.querySelector("form");
        var addTaskBtn = document.querySelector("#add-task");

        form.addEventListener("submit", function (event) {
          event.preventDefault();
          var dateValue = document.querySelector("#date").value;

          fetch("data.json")
            .then(function (response) {
              return response.json();
            })
            .then(function (data) {
              var toDoList = document.querySelector("#to-do-list");
              toDoList.innerHTML = ""; // Clear previous results
              var table = document.createElement("table");
              var tableHeader = table.createTHead();
              var headerRow = tableHeader.insertRow();
              var descHeader = document.createElement("th");
              descHeader.textContent = "Description";
              headerRow.appendChild(descHeader);

              var matchingItems = data.filter(function (item) {
                return item.date === dateValue;
              });

              if (matchingItems.length === 0) {
                var noItemsRow = table.insertRow();
                var noItemsCell = noItemsRow.insertCell();
                noItemsCell.colSpan = 2;
                noItemsCell.textContent = "No items found for selected date.";
              } else {
                matchingItems[0].list.forEach(function (item) {
                  var row = table.insertRow();
                  var descCell = row.insertCell();
                  var bullet = document.createElement("span");
                  bullet.classList.add("bullet");
                  bullet.textContent = "•";
                  if (item.status === "Done") {
                    descCell.classList.add("done");
                    bullet.textContent = "✔️";
                  }
                  bullet.addEventListener("click", function () {
                    if (item.status === "Not Done") {
                      item.status = "Done";
                      descCell.classList.add("done");
                      bullet.textContent = "✔️";
                    } else {
                      item.status = "Not Done";
                      descCell.classList.remove("done");
                      bullet.textContent = "•";
                    }
                    // Update the JSON file with the new status
                    fetch("data.json", {
                      method: "PUT",
                      headers: {
                        "Content-Type": "application/json",
                      },
                      body: JSON.stringify(data),
                    })
                      .then(function () {
                        console.log("Status updated successfully");
                      })
                      .catch(function (error) {
                        console.error("Error updating status:", error);
                      });
                  });
                  descCell.appendChild(bullet);
                  descCell.insertAdjacentText("beforeend", item.description);
                });
              }
              toDoList.appendChild(table);
              addTaskBtn.style.display = "block";
            })
            .catch(function (error) {
              console.error("Error fetching data:", error);
            });
        });

        addTaskBtn.addEventListener("click", function () {
          var table = document.querySelector("table");
          var newRow = table.insertRow();
          var newCell = newRow.insertCell();
          var newInput = document.createElement("input");
          newInput.type = "text";
          newInput.name = "new-task";
          newInput.placeholder = "Add a new task...";
          newInput.addEventListener("keyup", function (event) {
            if (event.key === "Enter") {
              event.preventDefault();
              var description = newInput.value.trim();
              var item = { description: description, status: "Not Done" };
              var data = JSON.parse(sessionStorage.getItem("data")) || [];
              var today = new Date().toISOString().slice(0, 10);
              if (
                !data[
                  data.find(function (entry) {
                    return entry.date === today;
                  })
                ]
              ) {
                data.push({ date: today, list: [] });
              }
              data
                .find(function (entry) {
                  return entry.date === today;
                })
                .list.push(item);
              // Update the JSON file with the new task
              fetch("data.json", {
                method: "PUT",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
              })
                .then(function () {
                  console.log("Task added successfully");
                })
                .catch(function (error) {
                  console.error("Error adding task:", error);
                });

              // Add the new task to the table
              var row = table.insertRow();
              var descCell = row.insertCell();
              var bullet = document.createElement("span");
              bullet.classList.add("bullet");
              bullet.textContent = "•";
              bullet.addEventListener("click", function () {
                if (item.status === "Not Done") {
                  item.status = "Done";
                  descCell.classList.add("done");
                  bullet.textContent = "✔️";
                } else {
                  item.status = "Not Done";
                  descCell.classList.remove("done");
                  bullet.textContent = "•";
                }
                // Update the JSON file with the new status
                fetch("data.json", {
                  method: "PUT",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify(data),
                })
                  .then(function () {
                    console.log("Status updated successfully");
                  })
                  .catch(function (error) {
                    console.error("Error updating status:", error);
                  });
              });
              descCell.appendChild(bullet);
              descCell.insertAdjacentText("beforeend", description);
              newInput.value = "";
            }
          });
          newCell.appendChild(newInput);
          newInput.focus();
          addTaskBtn.style.display = "none";
        });
      });
    </script>
  </body>
</html>
