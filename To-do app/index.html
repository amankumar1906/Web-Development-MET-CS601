<!DOCTYPE html>
<html>
  <head>
    <title>To-Do List</title>
    <style>
      span.bullet {
        margin-left: 10px;
        margin-right: 5px;
        font-weight: bold;
        color: #555;
        padding-right: 5px;
        border-radius: 10px;
      }

      table {
        border-collapse: collapse;
        width: 100%;
      }

      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }

      th {
        background-color: #f2f2f2;
      }

      .bullet {
        display: inline-block;
        width: 10px;
        text-align: center;
        cursor: pointer;
      }

      .done {
        text-decoration: line-through;
      }

      #add-task {
        display: none;
        margin-top: 20px;
      }

      #add-task-data {
        display: none;
      }
    </style>
  </head>
  <body>
    <h1>To-Do List</h1>
    <form>
      <label for="date">Date:</label>
      <input type="date" id="date-input" name="date-input">
      </select>
    </form>
    <div id="to-do-list"></div>
    <button id="add-task">Add Task</button>
    <button id="add-task-data"> Add Task</button>
    <script>
document.addEventListener("DOMContentLoaded", function () {
  var form = document.querySelector("form");
  var addTaskBtn = document.querySelector("#add-task");
  var addTaskData = document.querySelector("#add-task-data");
  var dateValue;
  var storedData = {};

  const myDateInput = document.querySelector("#date-input");

  myDateInput.addEventListener("change", function (event) {
    event.preventDefault();
    dateValue = document.querySelector("#date-input").value;

    // Check if data is already stored for this date in local storage
    var storedDataStr = localStorage.getItem(dateValue);
    if (storedDataStr !== null) {
      // Use stored data
      storedData = JSON.parse(storedDataStr);
      displayTasks(storedData.list);
    } else {
      // Fetch new data and store in local storage
      fetch("data.json")
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {
          var matchingItems = data.filter(function (item) {
            return item.date === dateValue;
          });

          if (matchingItems.length === 0) {
            // No items found for selected date
            displayNoTasksMessage();
          } else {
            displayTasks(matchingItems[0].list);
            storedData.list = matchingItems[0].list;
            localStorage.setItem(dateValue, JSON.stringify(storedData));
          }
        })
        .catch(function (error) {
          console.error("Error fetching data:", error);
        });
    }
  });

  function displayNoTasksMessage() {
    var toDoList = document.querySelector("#to-do-list");
    toDoList.innerHTML = "";

    // create a new table
    var table = document.createElement("table");
    var tableHeader = table.createTHead();
    var headerRow = tableHeader.insertRow();
    var descHeader = document.createElement("th");
    descHeader.textContent = "Description";
    headerRow.appendChild(descHeader);

    toDoList.appendChild(table);

    // display the add task button
    addTaskData.style.display = "block";

    addTaskData.addEventListener("click", function () {
      var description = prompt("Enter new task description:");
      if (description) {
        var newTask = { description: description, status: "Not Done" };
        if (!storedData.list) {
        storedData.list = [];
      }
        // add the new task to the stored data list
        storedData.list.push(newTask);
        localStorage.setItem(dateValue, JSON.stringify(storedData));
        displayTasks(storedData.list);
      }
    });

    // display the description
    var noItemsMsg = document.createElement("p");
    noItemsMsg.textContent =
      "No items found for selected date. Add a new task:";
    table.insertAdjacentElement("afterend", noItemsMsg);
  }

  function displayTasks(tasks) {
  var toDoList = document.querySelector("#to-do-list");
  toDoList.innerHTML = "";
  var table = document.createElement("table");
  var tableHeader = table.createTHead();
  var headerRow = tableHeader.insertRow();
  var descHeader = document.createElement("th");
  descHeader.textContent = "Description";
  headerRow.appendChild(descHeader);

  tasks.forEach(function (item) {
    var row = table.insertRow();
    var descCell = row.insertCell();
    var bullet = document.createElement("span");
    bullet.classList.add("bullet");
    bullet.textContent = "•";
    if (item.status === "Done") {
      descCell.classList.add("done");
      bullet.textContent = "✔️";
    }
    bullet.addEventListener("click", function () {
      if (item.status === "Not Done") {
        item.status = "Done";
        descCell.classList.add("done");
        bullet.textContent = "✔️";
      } else {
        item.status = "Not Done";
        descCell.classList.remove("done");
        bullet.textContent = "•";
      }
      // Update local storage with the new status
      storedData.list.forEach(function (storedItem) {
        if (storedItem.description === item.description) {
          storedItem.status = item.status;
        }
      });
      localStorage.setItem(dateValue, JSON.stringify(storedData));
    });

    descCell.appendChild(bullet);
    descCell.insertAdjacentText("beforeend", item.description);
    row.appendChild(descCell);
  });

  toDoList.appendChild(table);

  if (addTaskData.style.display === "block") {
    addTaskData.style.display = "none";
  }

  addTaskBtn.style.display='block';
}


        addTaskBtn.addEventListener("click", function () {
          var description = prompt("Enter new task description:");
          if (description) {
            var newTask = { description: description, status: "Not Done" };
            console.log('last')
            storedData.list.push(newTask);
            localStorage.setItem(dateValue, JSON.stringify(storedData));
            displayTasks(storedData.list);
          }
        });
      });
    </script>
  </body>
</html>
