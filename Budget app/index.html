<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Budget App</title>
    <style>
      .container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        width: 50%;
      }

      body {
        font-size: 16px;
        line-height: 1.5;
      }

      input[type="text"] {
        display: block;
        width: 15%;
        margin-bottom: 10px;
      }

      button {
        background-color: blue;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      td,
      th {
        padding: 10px;
        text-align: left;
      }

      th {
        background-color: #f2f2f2;
        font-weight: bold;
      }

      tfoot td {
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <label for="date-input">Enter month and year (mm/yyyy):</label>
      <input type="text" id="date-input" name="date" />
      <button onclick="fetchData()">Fetch Data</button>
      <table id="budget-table" style="display: none">
        <thead>
          <tr>
            <th>Description</th>
            <th>Cost</th>
            <th></th>
            <th></th>
          </tr>
        </thead>
        <tbody id="budget-table-body"></tbody>
        <tfoot>
          <tr>
            <td><b>Total Expenditure:</b></td>
            <td id="total-expenditure"></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td><b>Total Budget:</b></td>
            <td id="total-budget"></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td><b>Total Savings:</b></td>
            <td id="total-savings"></td>
            <td></td>
            <td></td>
          </tr>
        </tfoot>
      </table>
      <button
        id="add-expense-button"
        style="display: none"
        onclick="addExpense()"
      >
        Add Expense
      </button>
    </div>
    <script>
      let budgetData = null;

      function fetchData() {
        const dateInput = document.getElementById("date-input").value;
        const data = {
          date: dateInput,
        };
        fetch("data.json")
          .then((response) => response.json())
          .then((jsonData) => {
            const foundData = jsonData.find((d) => d.date === data.date);
            if (foundData) {
              budgetData = foundData;
              localStorage.setItem("budgetData", JSON.stringify(foundData));
              showTable(budgetData);
              const addExpenseButton =
                document.getElementById("add-expense-button");
              addExpenseButton.style.display = "";
            } else {
              const newBudget = prompt(
                "No budget found for the given date. Please enter a new budget:"
              );
              if (newBudget) {
                budgetData = {
                  date: data.date,
                  budget: parseFloat(newBudget),
                  expenditures: [],
                };
                localStorage.setItem("budgetData", JSON.stringify(budgetData));
                showTable(budgetData);
                const addExpenseButton =
                  document.getElementById("add-expense-button");
                addExpenseButton.style.display = "";
              }
            }
          });
      }

      function showTable(data) {
        const tableBody = document.getElementById("budget-table-body");
        tableBody.innerHTML = "";
        let totalExpenditure = 0;
        data.expenditures.forEach((expense, index) => {
          const row = document.createElement("tr");
          const descriptionCell = document.createElement("td");
          descriptionCell.innerText = expense.description;
          row.appendChild(descriptionCell);
          const costCell = document.createElement("td");
          costCell.innerText = expense.cost;
          row.appendChild(costCell);
          totalExpenditure += expense.cost;
          const editCell = document.createElement("td");
          const editButton = document.createElement("button");
          editButton.innerText = "Edit";
          editButton.addEventListener("click", () => editExpense(index));
          editCell.appendChild(editButton);
          row.appendChild(editCell);
          const deleteCell = document.createElement("td");
          const deleteButton = document.createElement("button");
          deleteButton.innerText = "Delete";
          deleteButton.addEventListener("click", () => deleteExpense(index));
          deleteCell.appendChild(deleteButton);
          row.appendChild(deleteCell);
          tableBody.appendChild(row);
        });
        const table = document.getElementById("budget-table");
        table.style.display = "";
        const totalExpenditureCell =
          document.getElementById("total-expenditure");
        totalExpenditureCell.innerText = totalExpenditure;
        const totalBudgetCell = document.getElementById("total-budget");
        totalBudgetCell.innerText = data.budget;
        const totalSavingsCell = document.getElementById("total-savings");
        const totalSavings = data.budget - totalExpenditure;
        totalSavingsCell.innerText = totalSavings;
      }
      function addExpense() {
        const description = prompt("Enter description:");
        if (description === null || description === "") {
          return;
        }
        const costString = prompt("Enter cost:");
        if (costString === null || costString === "") {
          return;
        }
        const cost = parseFloat(costString);
        if (isNaN(cost)) {
          alert("Invalid cost value. Please enter a number.");
          return;
        }
        const newExpense = {
          description: description,
          cost: cost,
        };
        budgetData.expenditures.push(newExpense);
        localStorage.setItem("budgetData", JSON.stringify(budgetData));
        showTable(budgetData);
      }
      function editExpense(index) {
        const expense = budgetData.expenditures[index];
        const newDescription = prompt(
          `Enter new description for ${expense.description}:`,
          expense.description
        );
        if (newDescription === null || newDescription === "") {
          return;
        }
        const newCostString = prompt(
          `Enter new cost for ${expense.description}:`,
          expense.cost
        );
        if (newCostString === null || newCostString === "") {
          return;
        }
        const newCost = parseFloat(newCostString);
        if (isNaN(newCost)) {
          alert("Invalid cost value. Please enter a number.");
          return;
        }
        expense.description = newDescription;
        expense.cost = newCost;
        localStorage.setItem("budgetData", JSON.stringify(budgetData));
        showTable(budgetData);
      }

      function deleteExpense(index) {
        const confirmDelete = confirm(
          "Are you sure you want to delete this expense?"
        );
        if (confirmDelete) {
          budgetData.expenditures.splice(index, 1);
          localStorage.setItem("budgetData", JSON.stringify(budgetData));
          showTable(budgetData);
        }
      }

      // Load data from localStorage if it exists
      const savedData = localStorage.getItem("budgetData");
      if (savedData) {
        budgetData = JSON.parse(savedData);
        showTable(budgetData);
        const addExpenseButton = document.getElementById("add-expense-button");
        addExpenseButton.style.display = "";
      }
    </script>
  </body>
</html>
